<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --yorha-gold: #c8a355; 
            --yorha-ui: #dadada; 
            --yorha-bg: #000; 
            --yorha-red: #ff4d4d; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: var(--yorha-bg); color: var(--yorha-ui); 
            font-family: 'Courier New', monospace; margin: 0; padding: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: space-between; height: 100vh; border: 1.5px solid #333; 
            overflow: hidden; 
        }

        .event-header { 
            width: 100%; border-bottom: 1px solid var(--yorha-ui); 
            display: flex; justify-content: space-between; padding-bottom: 5px; font-size: 11px; 
        }

        .prize-container { 
            flex: 1; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
        }
        
        .prize-image { 
            width: 130px; transition: all 0.5s ease;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.1));
        }

        .prize-image.complete {
            filter: drop-shadow(0 0 20px var(--yorha-gold));
            transform: scale(1.1);
        }

        #claimBtn { 
            background: var(--yorha-gold); color: #000; border: none; 
            padding: 10px 30px; font-size: 14px; font-weight: bold; 
            cursor: pointer; display: none; text-transform: uppercase; 
            margin-top: 15px; animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(200, 163, 85, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(200, 163, 85, 0); }
            100% { box-shadow: 0 0 0 0 rgba(200, 163, 85, 0); }
        }

        .progress-section { width: 100%; text-align: center; }
        .progress-bar-bg { 
            width: 100%; height: 10px; background: #111; 
            border: 1px solid #444; margin: 10px 0; position: relative;
        }
        .progress-fill { 
            height: 100%; background: var(--yorha-ui); width: 0%; 
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
        }

        #status-txt { font-size: 9px; color: #666; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="event-header">
        <span>PROTOCOL: SILVER_5</span>
        <span id="timer">--:--:--</span>
    </div>

    <div class="prize-container">
        <img src="https://i.ibb.co/kV2bJqTR/Silver-box.png" class="prize-image" id="prizeImg">
        <button id="claimBtn" onclick="location.href='UGold.html'">CLAIMED</button>
    </div>

    <div class="progress-section">
        <div style="display:flex; justify-content:space-between; font-size:10px;">
            <span>RECOVERY PROGRESS</span>
            <span id="countTxt">0 / 5</span>
        </div>
        <div class="progress-bar-bg">
            <div id="fill" class="progress-fill"></div>
        </div>
        <div id="status-txt">DETECTING SHOP TRANSACTIONS...</div>
    </div>

    <script>
        // --- إعدادات ثابتة ---
        const BOX_PRICE = 1000; // السعر الذي يخصمه المتجر
        const GOAL = 5;         // الهدف الجديد
        const DURATION = 24 * 60 * 60 * 1000; // 24 ساعة بالملي ثانية

        // --- إدارة الوقت ---
        function initTimer() {
            let startTime = localStorage.getItem('event_start_time');
            if (!startTime) {
                startTime = Date.now();
                localStorage.setItem('event_start_time', startTime);
            }

            setInterval(() => {
                let now = Date.now();
                let elapsed = now - startTime;
                let remaining = DURATION - elapsed;

                if (remaining <= 0) {
                    document.getElementById('timer').innerText = "EXPIRED";
                    // اختياري: تصغير العداد هنا إذا انتهى الوقت
                    // localStorage.removeItem('event_start_time');
                    return;
                }

                let h = Math.floor(remaining / 3600000);
                let m = Math.floor((remaining % 3600000) / 60000);
                let s = Math.floor((remaining % 60000) / 1000);
                document.getElementById('timer').innerText = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        // --- إدارة الرصد ---
        let lastGold = parseInt(localStorage.getItem('yorha_gold')) || 0;

        function sync() {
            let currentGold = parseInt(localStorage.getItem('yorha_gold')) || 0;
            let currentBoxes = parseInt(localStorage.getItem('opened_boxes')) || 0;

            // إذا نقص الذهب فجأة (دليل على الشراء)
            if (currentGold < lastGold) {
                let diff = lastGold - currentGold;
                // إذا كان النقص يقبل القسمة على سعر الصندوق
                if (diff >= BOX_PRICE) {
                    let bought = Math.floor(diff / BOX_PRICE);
                    currentBoxes += bought;
                    localStorage.setItem('opened_boxes', currentBoxes);
                }
            }
            lastGold = currentGold;

            // تحديث العرض
            let percent = (currentBoxes / GOAL) * 100;
            document.getElementById('fill').style.width = Math.min(percent, 100) + '%';
            document.getElementById('countTxt').innerText = `${currentBoxes} / ${GOAL}`;

            if (currentBoxes >= GOAL) {
                document.getElementById('claimBtn').style.display = 'block';
                document.getElementById('prizeImg').classList.add('complete');
                document.getElementById('status-txt').innerText = "MISSION SUCCESSFUL. ACCESS UGold.html";
                document.getElementById('status-txt').style.color = "var(--yorha-gold)";
            }
        }

        window.onload = () => {
            initTimer();
            setInterval(sync, 800); // فحص سريع كل 800 جزء من الثانية
        };
    </script>
</body>
</html>
