<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --yorha-gold: #c8a355; 
            --yorha-ui: #dadada; 
            --yorha-bg: #000; 
            --yorha-red: #ff4d4d; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: var(--yorha-bg); color: var(--yorha-ui); 
            font-family: 'Courier New', monospace; margin: 0; padding: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: space-between; height: 100vh; border: 1.5px solid #333; 
            overflow: hidden; 
        }

        .event-header { 
            width: 100%; border-bottom: 1px solid var(--yorha-ui); 
            display: flex; justify-content: space-between; padding-bottom: 5px; font-size: 11px; 
        }

        .prize-container { 
            flex: 1; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
        }
        
        .prize-image { 
            width: 130px; transition: all 0.5s ease;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.1));
        }

        .complete { filter: drop-shadow(0 0 20px var(--yorha-gold)); transform: scale(1.1); }

        #claimBtn { 
            background: var(--yorha-gold); color: #000; border: none; 
            padding: 10px 30px; font-size: 14px; font-weight: bold; 
            cursor: pointer; display: none; text-transform: uppercase; 
            margin-top: 15px; animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(200, 163, 85, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(200, 163, 85, 0); }
            100% { box-shadow: 0 0 0 0 rgba(200, 163, 85, 0); }
        }

        .progress-section { width: 100%; text-align: center; }
        .progress-bar-bg { 
            width: 100%; height: 10px; background: #111; 
            border: 1px solid #444; margin: 10px 0; 
        }
        .progress-fill { height: 100%; background: var(--yorha-ui); width: 0%; transition: width 0.6s; }
    </style>
</head>
<body>

    <div class="event-header">
        <span>PROTOCOL: SILVER_5</span>
        <span id="timer">--:--:--</span>
    </div>

    <div class="prize-container">
        <img src="https://i.ibb.co/kV2bJqTR/Silver-box.png" class="prize-image" id="prizeImg">
        <button id="claimBtn" onclick="executeClaim()">CLAIM REWARD</button>
        <div id="alreadyClaimed" style="display:none; color:#4dff88; margin-top:15px; font-size:12px;">[ REWARD SECURED ]</div>
    </div>

    <div class="progress-section">
        <div style="display:flex; justify-content:space-between; font-size:10px;">
            <span>BOXES FOUND</span>
            <span id="countTxt">0 / 5</span>
        </div>
        <div class="progress-bar-bg"><div id="fill" class="progress-fill"></div></div>
        <div id="status-txt" style="font-size:9px; color:#666;">MONITORING...</div>
    </div>

    <script>
        const BOX_PRICE = 1000; 
        const GOAL = 5;
        const EVENT_DURATION = 24 * 60 * 60 * 1000; // 24 ساعة بالملي ثانية

        // --- نظام الوقت الذكي (لا يتحدث عند الدخول) ---
        function handleTimer() {
            let endTime = localStorage.getItem('silver_event_deadline');

            if (!endTime) {
                // إذا كانت هذه أول مرة يدخل فيها، حدد وقت النهاية (الآن + 24 ساعة)
                endTime = Date.now() + EVENT_DURATION;
                localStorage.setItem('silver_event_deadline', endTime);
            }

            setInterval(() => {
                let now = Date.now();
                let remaining = endTime - now;

                if (remaining <= 0) {
                    document.getElementById('timer').innerText = "EXPIRED";
                    return;
                }

                let h = Math.floor(remaining / (1000 * 60 * 60));
                let m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                let s = Math.floor((remaining % (1000 * 60)) / 1000);
                
                document.getElementById('timer').innerText = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        // --- نظام الاستلام ومنع الغلتش ---
        function executeClaim() {
            if (localStorage.getItem('silver_event_claimed') === 'true') return;
            
            localStorage.setItem('silver_event_claimed', 'true');
            document.getElementById('claimBtn').style.display = 'none';
            document.getElementById('alreadyClaimed').style.display = 'block';

            setTimeout(() => { window.location.href = 'UGold.html'; }, 300);
        }

        let lastGold = parseInt(localStorage.getItem('yorha_gold')) || 0;

        function sync() {
            // التحقق من حالة الاستلام
            if (localStorage.getItem('silver_event_claimed') === 'true') {
                document.getElementById('claimBtn').style.display = 'none';
                document.getElementById('alreadyClaimed').style.display = 'block';
                document.getElementById('fill').style.width = '100%';
                document.getElementById('countTxt').innerText = '5 / 5';
                return;
            }

            let currentGold = parseInt(localStorage.getItem('yorha_gold')) || 0;
            let currentBoxes = parseInt(localStorage.getItem('opened_boxes')) || 0;

            // رصد الشراء من نقص الذهب
            if (currentGold < lastGold) {
                let diff = lastGold - currentGold;
                if (diff >= BOX_PRICE) {
                    currentBoxes += Math.floor(diff / BOX_PRICE);
                    localStorage.setItem('opened_boxes', currentBoxes);
                }
            }
            lastGold = currentGold;

            // تحديث العرض
            let count = Math.min(currentBoxes, GOAL);
            let percent = (count / GOAL) * 100;
            document.getElementById('fill').style.width = percent + '%';
            document.getElementById('countTxt').innerText = `${count} / 5`;

            if (count >= GOAL) {
                document.getElementById('claimBtn').style.display = 'block';
                document.getElementById('prizeImg').classList.add('complete');
            }
        }

        window.onload = () => {
            handleTimer();
            setInterval(sync, 1000);
        };
    </script>
</body>
</html>
