<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --color-gold: #ffcc00; 
            --color-dia: #00f2ff; /* أزرق ألماسي صريح */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-image: url('https://i.ibb.co/5gR875vF/1.jpg');
            background-size: cover; background-position: center;
            color: #dadada; font-family: 'Courier New', monospace; 
            margin: 0; padding: 15px; display: flex; flex-direction: column; 
            align-items: center; height: 320px; width: 320px; border: 1px solid #333; 
            overflow: hidden; position: relative;
        }

        body::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); z-index: 1;
        }

        /* الخط الأبيض الماسح */
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: #fff; box-shadow: 0 0 15px #fff;
            animation: scanMove 3s linear infinite; z-index: 5;
        }
        @keyframes scanMove { 0% { top: -2px; } 50% { top: 100%; } 100% { top: -2px; } }

        .event-header, .prize-container, .progress-section { position: relative; z-index: 10; }
        .event-header { width: 100%; border-bottom: 1px solid #444; display: flex; justify-content: space-between; font-size: 10px; padding-bottom: 5px; }

        .prize-container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        
        /* دائرة الضوء الخلفية - تعمل بقوة طوال الوقت */
        .glow-back {
            position: absolute; width: 110px; height: 110px; border-radius: 50%;
            filter: blur(35px); opacity: 0.8; z-index: -1; 
            animation: pulseGlow 2s infinite alternate;
        }
        @keyframes pulseGlow {
            from { transform: scale(1); opacity: 0.6; }
            to { transform: scale(1.25); opacity: 0.9; }
        }

        .prize-image { width: 110px; z-index: 2; transition: 0.5s; }

        /* زر التحصيل الأبيض */
        #claimBtn { 
            background: #fff; color: #000; border: none; padding: 10px 25px; 
            font-size: 12px; font-weight: bold; cursor: pointer; display: none; 
            text-transform: uppercase; margin-top: 15px; animation: whitePulse 1.5s infinite;
        }
        @keyframes whitePulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.9); }
            70% { box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .progress-bar-bg { width: 100%; height: 8px; background: #111; border: 1px solid #444; margin: 5px 0; }
        .progress-fill { height: 100%; background: #fff; width: 0%; transition: 0.5s; box-shadow: 0 0 10px #fff; }
    </style>
</head>
<body>

    <div class="scan-line"></div>

    <div class="event-header">
        <span id="protocol-id">PROTOCOL: ...</span>
        <span id="timer">00:00:00</span>
    </div>

    <div class="prize-container">
        <div id="glowCircle" class="glow-back"></div>
        <img src="" class="prize-image" id="prizeImg">
        <button id="claimBtn">CLAIM REWARD</button>
    </div>

    <div class="progress-section">
        <div id="taskName" style="font-size:9px; margin-bottom:4px; letter-spacing:1px; color:#fff;">ANALYZING...</div>
        <div style="display:flex; justify-content:space-between; font-size:9px;">
            <span>SYNC DATA</span>
            <span id="countTxt">0 / 0</span>
        </div>
        <div class="progress-bar-bg"><div id="fill" class="progress-fill"></div></div>
    </div>

    <script>
        const EVENTS = [
            { id: "GOLD_BOX_HUNT", task: "OPEN 50 GOLD BOXES", goal: 50, img: "https://i.ibb.co/LdYJHjhr/Ultra-Goldbox.png", cost: 1000, key: "ev_g_box_total", color: "#ffcc00" },
            { id: "DIA_BOX_HUNT", task: "OPEN 50 DIAMOND BOXES", goal: 50, img: "https://i.ibb.co/sdDWC2NB/Ultra-Dimondbox.png", cost: 2000, key: "ev_d_box_total", color: "#00f2ff" },
            { id: "GOLD_COLLECTOR", task: "COLLECT 1,000,000 GOLD", goal: 1000000, img: "https://i.ibb.co/KcnHTGrz/Diamond.png", key: "ev_gold_total", color: "#ffcc00" }
        ];

        // تحديد اليوم
        const dayIdx = Math.floor(Date.now() / (1000*60*60*24)) % 3;
        const ev = EVENTS[dayIdx];

        // تطبيق اللون الصريح فوراً عند الفتح
        window.onload = () => {
            document.getElementById('protocol-id').innerText = `PROTOCOL: ${ev.id}`;
            document.getElementById('taskName').innerText = ev.task;
            document.getElementById('prizeImg').src = ev.img;
            
            // تطبيق اللون على الدائرة الخلفية وعلى ظل الصورة
            const glow = document.getElementById('glowCircle');
            glow.style.backgroundColor = ev.color;
            glow.style.boxShadow = `0 0 50px ${ev.color}`;
            
            const img = document.getElementById('prizeImg');
            img.style.filter = `drop-shadow(0 0 15px ${ev.color})`;

            document.getElementById('claimBtn').onclick = () => { location.href = ev.id + ".html"; };
            
            updateSystem();
            setInterval(updateSystem, 200);
            setInterval(runTimer, 1000);
        };

        let lastGoldValue = parseInt(localStorage.getItem('yorha_gold')) || 0;

        function updateSystem() {
            let currentGold = parseInt(localStorage.getItem('yorha_gold')) || 0;
            let currentProgress = parseInt(localStorage.getItem(ev.key)) || 0;

            if (dayIdx === 2) { 
                if (currentGold > lastGoldValue) {
                    currentProgress += (currentGold - lastGoldValue);
                    localStorage.setItem(ev.key, currentProgress);
                }
            } else { 
                if (currentGold < lastGoldValue) {
                    let spent = lastGoldValue - currentGold;
                    if (spent === ev.cost) {
                        currentProgress += 1;
                        localStorage.setItem(ev.key, currentProgress);
                    }
                }
            }
            lastGoldValue = currentGold;

            let per = Math.min((currentProgress / ev.goal) * 100, 100);
            document.getElementById('fill').style.width = per + '%';
            document.getElementById('countTxt').innerText = `${currentProgress.toLocaleString()} / ${ev.goal.toLocaleString()}`;

            if (currentProgress >= ev.goal) {
                document.getElementById('claimBtn').style.display = 'block';
                document.getElementById('prizeImg').style.filter = `drop-shadow(0 0 35px ${ev.color}) brightness(1.3)`;
                document.getElementById('glowCircle').style.transform = "scale(1.5)";
            }
        }

        function runTimer() {
            let diff = new Date().setHours(24,0,0,0) - new Date();
            let h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
            document.getElementById('timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }
    </script>
</body>
</html>
